{% extends "base.html" %}
{% set show_navbar = false %}

{% block title %}Patient Dashboard{% endblock %}

{% block content %}
<div class="carousel-bg">
  <img src="{{ url_for('static', filename='images/slide1.jpg') }}" alt="Dashboard Background" />
</div>
<div class="hero-overlay"></div>
<div class="hero-vignette"></div>

<div class="login-hero">
  <div class="badges">
    <span class="badge">...Instant booking...</span>
    <span class="badge">...Queue optimization...</span>
    <span class="badge">...Smart suggestions...</span>
  </div>

  <div class="login-headline">Your Appointment Dashboard</div>
  <div class="login-tagline">Book appointments instantly with top doctors at your clinic.</div>

  {% if session['user_id'] %}
    <div class="hero-buttons" style="margin-bottom: 10px;">
      <a href="{{ url_for('logout') }}" class="btn-neon btn-ghost" id="logoutBtn">
        <span class="shine"></span> Logout
      </a>
    </div>
  {% endif %}

  <div class="glass-form-box" style="margin-top: 18px;">
    <h2>Choose Your Doctor</h2>
    <form method="POST">
      {% for doctor in docs %}
        <label>
          <input type="radio" name="doc_id" value="{{ doctor.id }}" required
            {% if selected_doctor and doctor.id == selected_doctor.id %}checked{% endif %}>
          Dr. {{ doctor.email }}
        </label>
      {% endfor %}
      <button type="submit" class="btn-neon">
        <span class="shine"></span> Choose Doctor
      </button>
    </form>
  </div>

  {% if selected_doctor %}
  <div class="glass-form-box" style="margin-top:28px;">
    <h2>Time Slots â€” Dr. {{ selected_doctor.email }}</h2>
    <form method="POST">
      <input type="hidden" name="selected_doc_id" value="{{ selected_doctor.id }}">
      <label for="selected_date"><strong>Select Date:</strong></label>
      <input type="date"
        name="selected_date"
        id="selected_date"
        value="{{ selected_date }}"
        onchange="this.form.submit()" required
        style="margin-bottom:18px;">
      <br>
      {% if selected_date %}
        <div class="timeslot-container">
        {% for time in selected_doctor.all_time %}
  {% set is_booked = (selected_doctor.id, time) in booked_slot_times %}
  <input type="radio"
    id="slot{{ time }}"
    name="time"
    value="{{ time }}"
    {% if is_booked %}disabled{% endif %}
    required
    class="timeslot-radio">
  <label for="slot{{ time }}" class="timeslot-btn{% if is_booked %} disabled{% endif %}">
    {{ "%02d:00"|format(time|int) }}{% if is_booked %} (Booked){% endif %}
  </label>
{% endfor %}
        </div>
        <button type="submit" class="btn-neon">
          <span class="shine"></span> Book Slot
        </button>
      {% else %}
        <p><em>Please select a date to view available slots.</em></p>
      {% endif %}
    </form>
  </div>
  {% endif %}
</div>
{% endblock %}
